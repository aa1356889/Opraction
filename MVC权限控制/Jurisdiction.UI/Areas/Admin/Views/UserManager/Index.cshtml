@{
    ViewBag.Title = "Index";
}

<ul class="breadcrumb">
				<li>
					<i class="icon-home"></i>
					<a href="index.html">后台管理</a> 
				</li>
				<li><a href="@Url.Action("Index","UserManager")">用户管理</a></li>
			</ul>
<div class="container-fluid" style="margin-bottom:20px;">
  <div class="row">
    <div class="col-md-12">
          @if (IsOpraction(ViewContext.RouteData.DataTokens["area"].ToString(), ViewContext.RouteData.Values["controller"].ToString(), "AddUser"))
          {
        <button type="button" id="addRole" class="btn btn-default">添加用户</button>
        }
    </div>
  </div>
</div>

<table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th><input type="checkbox" class="chek" /></th>
                <th>编号</th>
                <th>登陆名</th>
                <th>用户名字</th>
                <th>分配角色</th>
                <th>操作</th>

            </tr>
        </thead>
        <tbody>

          
        </tbody>
    </table>
<div id="AddModel">
   <button type="button" id="OkAplay" class="btn btn-default">确认分配</button>
 <table  id="roles" class="table table-bordered">
</table>
      
</div>
@section jss{
<script type="text/javascript">
    var addUserModel=null;//添加角色的模态框
    var datable=null;
    $(function () {
        addUserModel = commObj.InitModal("AddModel", "分配角色", 600, 168)
        //渲染表格
        datable= commObj.LoadTable("#example",
            [
                {"data":null},
                { "data": "uid" },
                { "data": "LoginName" },
                { "data": "Uname" },
                { "data": null },
            ],
            [
                {
                    "targets": 0,
                    "render": function (data, type, full, meta) {
                        return "<input type=\"checkbox\" class='uid' value='" + data.uid + "'>";
                    }
                },
                 {
                     "targets": 4,
                     "render": function (data, type, full, meta) {
                         var html = "";
                         @{
                             if (IsOpraction(ViewContext.RouteData.DataTokens["area"].ToString(), ViewContext.RouteData.Values["controller"].ToString(), "ApplayRole"))
                             {
                            <text>html = "<button class=\"btn btn-primary noty aplayRole\" uid=\"" + data.uid + "\"  >分配角色</button>";</text>
                             }
                          }
                         return html;
                     }
                 },
                 {
                     "targets": 5,
                     "render": function (data, type, full, meta) {
                         return "<a class=\"btn btn-info\" href=\"#\" class='eidt'><i class=\"halflings-icon white edit\"></i>  </a>   <a class=\"btn btn-danger\" href=\"#\" class><i class=\"halflings-icon white trash\"></i> </a>";
                     }
                 }
            ],
            "@Url.Action("GetUsers")",
            function (d) {
                d.daw = 1;
                d.star = 0;
                d.length = 10;
                return d;
            }
            );
    })
    $("#addRole").click(function (e) {
       var uid=$(this).attr("uid");
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetRoles")",
            dataType: "json",
            data: { uid:uid },
            success: function (ajaxObj) {
                var dataArr = [];
                if (ajaxObj.State == 0) {
                    alert(ajaxObj.Message);
                    datable.ajax.reload();
                    addRoleModel.modal("hide");
                } else {
                    alert(ajaxObj.Message);
                }
            }
        });
        addUserModel.modal("show");
       
    })

    $("#example").delegate(".aplayRole", "click", function () {
        var uid = $(this).attr("uid");
        if (rid) {
            window.location = "@Url.Action("SetOpreaction")?rid=" + rid;
        }
      })
    //取消按钮事件
    $("#CanckeUser").click(function () {
        addUserModel.modal("hide");
    })
    //确认添加点击事件
    $("#OkAddUser").click(function () {
        var roleName = $("#roleName").val();
        $.ajax({
            type: "POST",
            url: "@Url.Action("AddRole")",
                dataType: "json",
                data: { roleName: roleName },
                success: function (ajaxObj) {
                    var dataArr = [];
                    if (ajaxObj.State == 0) {
                        alert(ajaxObj.Message);
                        datable.ajax.reload();
                        addRoleModel.modal("hide");
                    } else {
                        alert(ajaxObj.Message);
                    }
                }
         });
    })
</script>
    }
